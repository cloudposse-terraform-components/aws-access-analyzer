name: "aws-access-analyzer"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-access-analyzer"
# Short description of this project
description: |-
  This component is responsible for configuring AWS Identity and Access Management Access Analyzer within an AWS
  Organization.

  IAM Access Analyzer helps identify resources in your organization and accounts that are shared with external entities,
  as well as unused access permissions. This enables you to identify unintended access to your resources and data, which
  is a critical security risk. Access Analyzer uses logic-based reasoning to analyze resource-based policies in your AWS
  environment and generates findings for each instance of a resource shared outside your account.

  ## Key Features

  - **External Access Analysis**: Identifies resources shared with external principals outside your organization
  - **Unused Access Analysis**: Detects unused IAM roles, users, and permissions to implement least privilege
  - **Policy Validation**: Validates IAM policies against policy grammar and AWS best practices
  - **Custom Policy Checks**: Validates IAM policies against your specified security standards
  - **Policy Generation**: Generates least-privilege IAM policies based on CloudTrail access activity

  ## Analyzer Types

  This component creates two types of organization-wide analyzers:

  | Analyzer Type | Purpose | Findings |
  |---------------|---------|----------|
  | `ORGANIZATION` | External access analysis | Public access, cross-account access, cross-organization access |
  | `ORGANIZATION_UNUSED_ACCESS` | Unused access analysis | Unused roles, users, permissions (configurable threshold) |

  ## Supported Resources

  External access analyzer monitors the following resource types:
  - Amazon S3 buckets and access points
  - IAM roles and policies
  - AWS KMS keys
  - AWS Lambda functions and layers
  - Amazon SQS queues
  - AWS Secrets Manager secrets
  - Amazon SNS topics
  - Amazon EBS volume snapshots
  - Amazon RDS DB snapshots and cluster snapshots
  - Amazon ECR repositories
  - Amazon EFS file systems

  ## Regional Deployment

  IAM Access Analyzer is a regional service. You must deploy analyzers to each region where you have resources that need
  monitoring. The delegation from the management account only needs to happen once (globally), but analyzers must be
  created in each region.

  ## Deployment Workflow

  > **Important**: Step 1 must be completed successfully before Step 2 can run. The delegation and service-linked role
  > created in Step 1 are prerequisites for creating organization-level analyzers in Step 2.

  **Step 1 - Delegate Access Analyzer (Management Account)**: From the Organization management (root) account, delegate
  administration to the security account. This step also creates the required service-linked role.

  **Step 2 - Create Analyzers (Delegated Administrator)**: Deploy the external access and unused access analyzers in the
  delegated administrator account for each region.

  ## Service-Linked Role

  AWS Access Analyzer requires a service-linked role (`AWSServiceRoleForAccessAnalyzer`) in the organization management
  account before organization-level analyzers can be created from the delegated administrator. This component
  automatically creates this role when deploying to the root account with `organizations_delegated_administrator_enabled: true`.

  The service-linked role creation can be controlled with the `service_linked_role_enabled` variable:
  - `true` (default): Creates the service-linked role when delegating administration
  - `false`: Skips creation (use if the role already exists or was created manually/by another process)

  ## Configuration

  > **Note**: The examples below use Cloud Posse naming conventions (e.g., `core-security` for the security account,
  > `plat-gbl-root` for stack names). Adjust these values to match your organization's account and stack naming conventions.

  ### Defaults (Abstract Component)

  ```yaml
  components:
    terraform:
      access-analyzer/defaults:
        metadata:
          component: access-analyzer
          type: abstract
        vars:
          enabled: true
          global_environment: gbl
          account_map_tenant: core
          root_account_stage: root
          # The account name of your delegated administrator (typically your security account)
          # Adjust to match your organization's account naming convention
          delegated_administrator_account_name: core-security
          accessanalyzer_service_principal: "access-analyzer.amazonaws.com"
          accessanalyzer_organization_enabled: false
          accessanalyzer_organization_unused_access_enabled: false
          organizations_delegated_administrator_enabled: false
          service_linked_role_enabled: true
  ```

  ### Root Account Configuration (Step 1)

  ```yaml
  import:
    - catalog/access-analyzer/defaults

  components:
    terraform:
      # Step 1: Deploy to root account to delegate administration and create service-linked role
      access-analyzer/root:
        metadata:
          component: access-analyzer
          inherits:
            - access-analyzer/defaults
        vars:
          organizations_delegated_administrator_enabled: true
          # Set to false if the service-linked role already exists
          service_linked_role_enabled: true
  ```

  ### Delegated Administrator Configuration (Step 2)

  ```yaml
  import:
    - catalog/access-analyzer/defaults

  components:
    terraform:
      # Step 2: Deploy to delegated administrator (security) account to create analyzers
      access-analyzer/delegated-administrator:
        metadata:
          component: access-analyzer
          inherits:
            - access-analyzer/defaults
        vars:
          accessanalyzer_organization_enabled: true
          accessanalyzer_organization_unused_access_enabled: true
          # Number of days without use before generating unused access findings (default: 30)
          unused_access_age: 30
  ```

  ## Provisioning

  > **Note**: Replace the stack names below (e.g., `plat-gbl-root`, `plat-use1-security`) with your actual stack names
  > based on your Atmos stack configuration.

  **Step 1:** Delegate Access Analyzer to the security account (run once from root/management account):

  ```bash
  # Replace with your root account stack name
  atmos terraform apply access-analyzer/root -s plat-gbl-root
  ```

  This step:
  - Creates the service-linked role for Access Analyzer (if `service_linked_role_enabled: true`)
  - Delegates Access Analyzer administration to the security account

  **Step 2:** Create analyzers in the delegated administrator (security) account for each region:

  ```bash
  # Replace with your security account stack names for each region
  atmos terraform apply access-analyzer/delegated-administrator -s plat-use1-security
  atmos terraform apply access-analyzer/delegated-administrator -s plat-usw2-security
  ```

  This step creates the organization-wide analyzers:
  - External access analyzer (type: `ORGANIZATION`)
  - Unused access analyzer (type: `ORGANIZATION_UNUSED_ACCESS`)

  ## Cost Considerations

  - **External Access Analyzer**: No additional charge (included with AWS account)
  - **Unused Access Analyzer**: Charged per IAM role or user analyzed per month
  - See [IAM Access Analyzer pricing](https://aws.amazon.com/iam/access-analyzer/pricing/) for current rates

  ## References

  ### AWS Documentation
  - [What is IAM Access Analyzer?](https://docs.aws.amazon.com/IAM/latest/UserGuide/what-is-access-analyzer.html)
  - [Getting Started with Access Analyzer](https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-getting-started.html)
  - [Access Analyzer Findings](https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-findings.html)
  - [Unused Access Analysis](https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-unused-access.html)
  - [Service-Linked Role for Access Analyzer](https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-getting-started.html#access-analyzer-permissions)
  - [Delegated Administrator for Access Analyzer](https://docs.aws.amazon.com/IAM/latest/UserGuide/access-analyzer-settings.html#access-analyzer-delegated-administrator)

  ### Terraform Resources
  - [aws_accessanalyzer_analyzer](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/accessanalyzer_analyzer)
  - [aws_iam_service_linked_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_service_linked_role)
  - [aws_organizations_delegated_administrator](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_delegated_administrator)

  ### Additional Resources
  - [IAM Access Analyzer Product Page](https://aws.amazon.com/iam/access-analyzer/)
  - [IAM Access Analyzer Pricing](https://aws.amazon.com/iam/access-analyzer/pricing/)
  - [Setting up Access Analyzer for Organization](https://repost.aws/knowledge-center/iam-access-analyzer-organization)
tags:
  - aws
  - iam
  - access-analyzer
  - security
  - compliance
  - organizations
# Categories of this project
categories: []
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-access-analyzer.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-access-analyzer/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
contributors: [] # If included generates contribs
